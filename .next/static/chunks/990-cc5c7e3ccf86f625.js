"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[990],{32990:function(t,e,a){var n=a(99697),i=a(78965),r=a(40230),o=a(21542);let s="@firebase/installations",u="0.6.10",l=`w:${u}`,f="FIS_v2",c=new r.LL("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function p(t){return t instanceof r.ZR&&t.code.includes("request-failed")}function d({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function g(t){return{token:t.token,requestStatus:2,expiresIn:Number(t.expiresIn.replace("s","000")),creationTime:Date.now()}}async function w(t,e){let a=(await e.json()).error;return c.create("request-failed",{requestName:t,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function h({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function m(t){let e=await t();return e.status>=500&&e.status<600?t():e}async function y({appConfig:t,heartbeatServiceProvider:e},{fid:a}){let n=d(t),i=h(t),r=e.getImmediate({optional:!0});if(r){let t=await r.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}let o={method:"POST",headers:i,body:JSON.stringify({fid:a,authVersion:f,appId:t.appId,sdkVersion:l})},s=await m(()=>fetch(n,o));if(s.ok){let t=await s.json();return{fid:t.fid||a,registrationStatus:2,refreshToken:t.refreshToken,authToken:g(t.authToken)}}throw await w("Create Installation",s)}function b(t){return new Promise(e=>{setTimeout(e,t)})}let S=/^[cdef][\w-]{21}$/;function C(t){return`${t.appName}!${t.appId}`}let k=new Map;function I(t,e){let a=C(t);T(a,e),function(t,e){let a=(!v&&"BroadcastChannel"in self&&((v=new BroadcastChannel("[Firebase] FID Change")).onmessage=t=>{T(t.data.key,t.data.fid)}),v);a&&a.postMessage({key:t,fid:e}),0===k.size&&v&&(v.close(),v=null)}(a,e)}function T(t,e){let a=k.get(t);if(a)for(let t of a)t(e)}let v=null,j="firebase-installations-store",q=null;function $(){return q||(q=(0,o.X3)("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(j)}})),q}async function O(t,e){let a=C(t),n=(await $()).transaction(j,"readwrite"),i=n.objectStore(j),r=await i.get(a);return await i.put(e,a),await n.done,r&&r.fid===e.fid||I(t,e.fid),e}async function N(t){let e=C(t),a=(await $()).transaction(j,"readwrite");await a.objectStore(j).delete(e),await a.done}async function P(t,e){let a=C(t),n=(await $()).transaction(j,"readwrite"),i=n.objectStore(j),r=await i.get(a),o=e(r);return void 0===o?await i.delete(a):await i.put(o,a),await n.done,o&&(!r||r.fid!==o.fid)&&I(t,o.fid),o}async function A(t){let e;let a=await P(t.appConfig,a=>{let n=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(c.create("app-offline"))};let a={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=D(t,a);return{installationEntry:a,registrationPromise:n}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:_(t)}:{installationEntry:e}}(t,E(a||{fid:function(){try{let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let e=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22);return S.test(e)?e:""}catch(t){return""}}(),registrationStatus:0}));return e=n.registrationPromise,n.installationEntry});return""===a.fid?{installationEntry:await e}:{installationEntry:a,registrationPromise:e}}async function D(t,e){try{let a=await y(t,e);return O(t.appConfig,a)}catch(a){throw p(a)&&409===a.customData.serverCode?await N(t.appConfig):await O(t.appConfig,{fid:e.fid,registrationStatus:0}),a}}async function _(t){let e=await x(t.appConfig);for(;1===e.registrationStatus;)await b(100),e=await x(t.appConfig);if(0===e.registrationStatus){let{installationEntry:e,registrationPromise:a}=await A(t);return a||e}return e}function x(t){return P(t,t=>{if(!t)throw c.create("installation-not-found");return E(t)})}function E(t){return 1===t.registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t}async function F({appConfig:t,heartbeatServiceProvider:e},a){let n=function(t,{fid:e}){return`${d(t)}/${e}/authTokens:generate`}(t,a),i=function(t,{refreshToken:e}){let a=h(t);return a.append("Authorization",`${f} ${e}`),a}(t,a),r=e.getImmediate({optional:!0});if(r){let t=await r.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}let o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:l,appId:t.appId}})},s=await m(()=>fetch(n,o));if(s.ok)return g(await s.json());throw await w("Generate Auth Token",s)}async function H(t,e=!1){let a;let n=await P(t.appConfig,n=>{var i;if(!V(n))throw c.create("not-registered");let r=n.authToken;if(!e&&2===(i=r).requestStatus&&!function(t){let e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(i))return n;if(1===r.requestStatus)return a=K(t,e),n;{if(!navigator.onLine)throw c.create("app-offline");let e=function(t){let e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(n);return a=M(t,e),e}});return a?await a:n.authToken}async function K(t,e){let a=await L(t.appConfig);for(;1===a.authToken.requestStatus;)await b(100),a=await L(t.appConfig);let n=a.authToken;return 0===n.requestStatus?H(t,e):n}function L(t){return P(t,t=>{var e;if(!V(t))throw c.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function M(t,e){try{let a=await F(t,e),n=Object.assign(Object.assign({},e),{authToken:a});return await O(t.appConfig,n),a}catch(a){if(p(a)&&(401===a.customData.serverCode||404===a.customData.serverCode))await N(t.appConfig);else{let a=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await O(t.appConfig,a)}throw a}}function V(t){return void 0!==t&&2===t.registrationStatus}async function X(t){let{installationEntry:e,registrationPromise:a}=await A(t);return a?a.catch(console.error):H(t).catch(console.error),e.fid}async function B(t,e=!1){return await R(t),(await H(t,e)).token}async function R(t){let{registrationPromise:e}=await A(t);e&&await e}function z(t){return c.create("missing-app-config-values",{valueName:t})}let J="installations";(0,n.Xd)(new i.wA(J,t=>{let e=t.getProvider("app").getImmediate(),a=function(t){if(!t||!t.options)throw z("App Configuration");if(!t.name)throw z("App Name");for(let e of["projectId","apiKey","appId"])if(!t.options[e])throw z(e);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),i=(0,n.qX)(e,"heartbeat");return{app:e,appConfig:a,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},"PUBLIC")),(0,n.Xd)(new i.wA("installations-internal",t=>{let e=t.getProvider("app").getImmediate(),a=(0,n.qX)(e,J).getImmediate();return{getId:()=>X(a),getToken:t=>B(a,t)}},"PRIVATE")),(0,n.KN)(s,u),(0,n.KN)(s,u,"esm2017")}}]);