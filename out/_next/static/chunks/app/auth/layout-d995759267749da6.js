(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{24969:function(e,t,a){Promise.resolve().then(a.bind(a,61827))},61827:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(57437),s=a(2265),i=a(99376),o=a(84832),n=a(27648),c=a(19778),l=a(3905),d=a(78931),u=a(71751),f=a(53229),m=a(59371),h=a(71973),p=a(84856),g=a(93448);let b=[{href:"/auth/dashboard",label:"In\xedcio",Icon:c.Z,ActiveIcon:f.Z},{href:"/auth/registros",label:"Registros",Icon:l.Z,ActiveIcon:m.Z},{href:"/auth/equipe",label:"Equipe",Icon:d.Z,ActiveIcon:h.Z},{href:"/auth/relatorios",label:"Relat\xf3rios",Icon:u.Z,ActiveIcon:p.Z}];function v(){let e=(0,i.usePathname)();return(0,r.jsx)("nav",{className:"bg-background/80 fixed inset-x-0 bottom-0 z-40 border-t pb-[env(safe-area-inset-bottom)] backdrop-blur-lg",children:(0,r.jsx)("div",{className:"mx-auto grid h-16 max-w-md grid-cols-4",children:b.map(t=>{let{href:a,label:s,Icon:i,ActiveIcon:o}=t,c=e.startsWith(a);return(0,r.jsxs)(n.default,{href:a,className:"flex flex-col items-center justify-center space-y-1 text-sm font-medium",children:[c?(0,r.jsx)(o,{className:"text-primary size-6"}):(0,r.jsx)(i,{className:"text-muted-foreground size-6"}),(0,r.jsx)("span",{className:(0,g.cn)("text-xs",c?"text-primary":"text-muted-foreground"),children:s})]},a)})})})}var w=a(5978),I=a(46410),x=a(77280),y=a(33145);function A(){return(0,r.jsx)("header",{className:"sticky top-0 z-40 bg-teal-600 shadow-md",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-2",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)(n.default,{href:"/auth/dashboard",className:"flex items-center gap-2",children:[(0,r.jsx)(y.default,{src:"/favicon.svg",alt:"PontoM\xe9dico Logo",width:28,height:28,className:"rounded-full bg-white p-0.5"}),(0,r.jsx)("h1",{className:"text-lg font-bold tracking-tight text-white",children:"PontoM\xe9dico"})]})})})})}function j(e){let{children:t}=e,{user:a,loading:n}=(0,o.a)(),c=(0,i.useRouter)(),l=(0,i.usePathname)();return((0,s.useEffect)(()=>{n||a||c.replace("/login?redirect=".concat(l))},[n,a,c,l]),!function(){let{user:e}=(0,o.a)(),t=(0,x.F)(e=>e.setRegistros);(0,s.useEffect)(()=>{if(!e)return;let a=(0,w.IO)((0,w.hJ)(I.db,"registros"),(0,w.ar)("usuarioId","==",e.uid),(0,w.Xo)("data","asc"),(0,w.Xo)("createdAt","asc"));return(0,w.cf)(a,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))})},[e,t])}(),(0,s.useEffect)(()=>{n||!a||localStorage.getItem("equipeId")||l.startsWith("/auth/equipe")||c.replace("/auth/equipe/onboarding")},[n,a,l,c]),n||!a)?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsx)("p",{className:"text-gray-600",children:"Carregando..."})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A,{}),(0,r.jsx)("main",{className:"min-h-screen bg-gray-50 pb-20",children:(0,r.jsx)("div",{className:"container mx-auto p-4",children:t})}),(0,r.jsx)(v,{})]})}},84832:function(e,t,a){"use strict";a.d(t,{a:function(){return f}});var r=a(2265),s=a(46410),i=a(43301),o=a(64131),n=a(738),c=a(76834);function l(e,t){let a=function(){try{let e=(0,n.C6)().length>0?(0,n.C6)()[0]:(0,n.ZF)({apiKey:"AIzaSyAxDEIXRouCF63f9GK-ShqzTaKQhQIjvyw",authDomain:"controle-horarios-medicos.firebaseapp.com",projectId:"controle-horarios-medicos",storageBucket:"controle-horarios-medicos.firebasestorage.app",messagingSenderId:"977729325505",appId:"1:977729325505:web:82fe901b78d874ef81c740",measurementId:"YOUR_MEASUREMENT_ID"});return c.getAnalytics(e)}catch(e){return console.warn("Analytics init falhou",e),null}}();a&&c.logEvent(a,e,t)}var d=a(5978),u=a(1186);function f(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,i.Aj)(s.I,async e=>{if(t(e),e){var a,r,i;let t=await e.getIdToken();o.Z.set("auth-token",t,{expires:1}),localStorage.setItem("user",JSON.stringify({uid:e.uid,email:e.email}));let n=(0,d.JU)(s.db,"users",e.uid);(await (0,d.QT)(n)).exists()||await (0,d.pl)(n,{email:e.email,nome:null!==(r=e.displayName)&&void 0!==r?r:"",role:"medico",createdAt:Date.now(),updatedAt:Date.now(),isActive:!0});let c=(await (0,d.QT)(n)).data();c&&!c.equipeId&&e.email&&await (0,u.Ol)(e.uid,e.email);let l=null!==(i=null===(a=(await (0,d.QT)(n)).data())||void 0===a?void 0:a.equipeId)&&void 0!==i?i:"";localStorage.setItem("equipeId",l)}else o.Z.remove("auth-token"),localStorage.removeItem("user");n(!1)}),a=(0,i.MX)(s.I,async e=>{if(e){let t=await e.getIdToken();o.Z.set("auth-token",t,{expires:1})}});return()=>{e(),a()}},[]);let c=(0,r.useCallback)(async(e,t)=>{await (0,i.e5)(s.I,e,t),l("login_success")},[]);return{user:e,loading:a,login:c,register:(0,r.useCallback)(async(e,t)=>{let a=await (0,i.Xb)(s.I,e,t);await (0,d.pl)((0,d.JU)(s.db,"users",a.user.uid),{email:e,nome:"",role:"medico",createdAt:Date.now(),updatedAt:Date.now(),isActive:!0}),l("register_success")},[]),logout:(0,r.useCallback)(async()=>{await (0,i.w7)(s.I),l("logout")},[]),resetPassword:(0,r.useCallback)(async e=>{await (0,i.LS)(s.I,e)},[])}}},46410:function(e,t,a){"use strict";let r;a.d(t,{I:function(){return c},db:function(){return l}});var s,i=a(738),o=a(43301),n=a(5978);r=null!==(s=window._firebaseApp)&&void 0!==s?s:(0,i.ZF)({apiKey:"AIzaSyAxDEIXRouCF63f9GK-ShqzTaKQhQIjvyw",authDomain:"controle-horarios-medicos.firebaseapp.com",projectId:"controle-horarios-medicos",storageBucket:"controle-horarios-medicos.firebasestorage.app",messagingSenderId:"977729325505",appId:"1:977729325505:web:82fe901b78d874ef81c740",measurementId:"YOUR_MEASUREMENT_ID"}),window._firebaseApp=r;let c=(0,o.v0)(r),l=(0,n.ad)(r);try{(0,n.ST)(l)}catch(e){e instanceof i.ZR&&("failed-precondition"===e.code?console.warn("A persist\xeancia do Firestore falhou. Isso geralmente ocorre se voc\xea tiver v\xe1rias abas abertas. Os dados n\xe3o ser\xe3o salvos offline nesta aba."):"unimplemented"===e.code&&console.warn("O navegador atual n\xe3o suporta persist\xeancia offline do Firestore."))}},1186:function(e,t,a){"use strict";a.d(t,{Cm:function(){return o},Lq:function(){return n},Ol:function(){return c}});var r=a(46410),s=a(66629),i=a(5978);async function o(e,t,a){let s=(0,i.JU)((0,i.hJ)(r.db,"equipes")),o={id:s.id,nome:t,adminId:e,membros:[e],invites:[],timezone:a,createdAt:Date.now(),isActive:!0};return await (0,i.pl)(s,o),await (0,i.r7)((0,i.JU)(r.db,"users",e),{equipeId:s.id,role:"admin_equipe",updatedAt:(0,i.Bt)()}),s.id}async function n(e,t){let a=(0,s.x0)(8);return await (0,i.r7)((0,i.JU)(r.db,"equipes",e),{invites:(0,i.vr)({email:t,code:a,status:"pending"})}),a}async function c(e,t){let a=(0,i.IO)((0,i.hJ)(r.db,"equipes"),(0,i.ar)("invites","array-contains",{code:t,status:"pending"})),s=await (0,i.PL)(a);if(s.empty)return console.error("Nenhum convite encontrado com o c\xf3digo:",t),!1;let o=s.docs[0],n=o.id,c=o.data().invites.map(e=>e.code===t?{...e,status:"accepted"}:e);return await (0,i.r7)(o.ref,{membros:(0,i.vr)(e),invites:c}),await (0,i.r7)((0,i.JU)(r.db,"users",e),{equipeId:n,role:"medico",updatedAt:(0,i.Bt)()}),!0}},93448:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var r=a(61994),s=a(53335);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}},77280:function(e,t,a){"use strict";a.d(t,{F:function(){return n}});var r=a(3011),s=a(89134),i=a(46410),o=a(5978);let n=(0,r.U)()((0,s.tJ)(e=>({registros:[],addRegistro:async t=>{e(e=>({registros:[...e.registros,t]}));try{await (0,o.pl)((0,o.JU)(i.db,"registros",t.id),t)}catch(a){throw console.error("Erro ao salvar no Firestore",a),e(e=>({registros:e.registros.filter(e=>e.id!==t.id)})),a}},updateRegistro:async(t,a)=>{e(e=>({registros:e.registros.map(e=>e.id===t?{...e,...a}:e)}));try{await (0,o.r7)((0,o.JU)(i.db,"registros",t),a)}catch(e){console.error("Erro ao atualizar no Firestore",e)}},deleteRegistro:async t=>{e(e=>({registros:e.registros.filter(e=>e.id!==t)}));try{await (0,o.oe)((0,o.JU)(i.db,"registros",t))}catch(e){console.error("Erro ao deletar no Firestore",e)}},setRegistros:t=>e({registros:t})}),{name:"registro-store"}))}},function(e){e.O(0,[358,237,188,909,137,648,696,971,117,744],function(){return e(e.s=24969)}),_N_E=e.O()}]);